<!DOCTYPE html>
<html>
	<head>
		<title>Ping Pong Game</title>
		<style>
			* {
				margin: 0;
			}
			canvas {
				box-shadow: black 20px 10px 50px;
				margin-top: 50vh;
				margin-left: 50px;
				transform: translateY(-50%);
			}
		</style>
	</head>
	<body>
		<canvas id="canvas"></canvas>
		<script type="text/javascript" src="js/utils.js"></script>
		<script type="text/javascript" src="js/app.js"></script>
		<script type="text/javascript">
			//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.

			app.onInit = function () {
				this.nodes.push({
					id: "player-1",
					x: this.width / 20 - this.width / 35,
					y: this.height / 4,
					width: this.width / 35,
					height: this.height / 4,
					color: "black",
				});

				this.nodes.push({
					id: "player-2",
					x: this.width - this.width / 20,
					y: this.height / 4,
					width: this.width / 35,
					height: this.height / 4,
					color: "black",
				});

				this.nodes.push({
					id: "ball",
					x: this.width / 2,
					y: this.height / 2,
					r: this.width / 60,
					color: "red",
					speed: 2,
					velocityX: -1,
					velocityY: 1,
				});

				//----------LOGIC TO MOVE PLAYERS--------BEGIN-------------//
				//controls that allow simultaneous movement of both player
				const movementControls = {
					player1Up: false,
					player1Down: false,
					player2Up: false,
					player2Down: false,
				};

				function updateMovementControls(e, controls, value) {
					if (e.keyCode == 87) {
						controls.player1Up = value;
					}
					if (e.keyCode == 83) {
						controls.player1Down = value;
					}
					if (e.keyCode == 38) {
						controls.player2Up = value;
					}
					if (e.keyCode == 40) {
						controls.player2Down = value;
					}
				}

				document.addEventListener("keydown", function (e) {
					updateMovementControls(e, movementControls, true);
					//function from utils.js file
					movePlayer(movementControls);
				});
				document.addEventListener("keyup", function (e) {
					updateMovementControls(e, movementControls, false);
					//function from utils.js file
					movePlayer(movementControls);
				});
				//----------LOGIC TO MOVE PLAYERS--------END-------------//
			};

			app.onUpdate = function (time) {
				const ball = this.getNode("ball");
				const player1 = this.getNode("player-1");
				const player2 = this.getNode("player-2");
				let playerInCollision = ball.x < this.width / 2 ? player1 : player2;

				//--------BALL MOVEMENT LOGIC AND COLLISION DETECTION--------//
				ball.x += ball.velocityX * ball.speed;
				ball.y += ball.velocityY * ball.speed;

				//logic if ball hits bottom or top of the canvas
				if (ball.y + ball.r >= this.height || ball.y - ball.r <= 0) {
					ball.velocityY = -ball.velocityY;
				}

				if (collision(ball, playerInCollision)) {
					// we check where the ball hits the paddle
					let collidePoint =
						ball.y - (playerInCollision.y + playerInCollision.height / 2);
					// normalize the value of collidePoint, we need to get numbers between -1 and 1.
					// -player.height/2 < collide Point < player.height/2
					collidePoint = collidePoint / (playerInCollision.height / 2);

					// when the ball hits the top of a paddle we want the ball, to take a -45degrees angle
					// when the ball hits the center of the paddle we want the ball to take a 0degrees angle
					// when the ball hits the bottom of the paddle we want the ball to take a 45degrees
					// Math.PI/4 = 45degrees
					let angleRad = (Math.PI / 4) * collidePoint;

					// change the X and Y velocity direction
					let direction = ball.x + ball.r < canvas.width / 2 ? 1 : -1;
					ball.velocityX = direction * ball.speed * Math.cos(angleRad);
					ball.velocityY = ball.speed * Math.sin(angleRad);

					// speed up the ball every time a paddle hits it.
					ball.speed += 0.1;
				}
				//-----------------------------------------------------------//
			};
		</script>
	</body>
</html>
